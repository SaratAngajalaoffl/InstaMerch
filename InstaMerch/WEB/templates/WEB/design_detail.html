{% extends 'WEB/base.html' %} {% block content %}
<div class="hero_image_container 50-percent"></div>

<div class="design_detail">
	<div class="right">
		<img
			src="{{design.picture.url}}"
			alt="{{design}}"
			width="350px"
			class="round-image"
		/>
		<div class="purchase-buttons">
			<a href="/" class="cart-buttons">CART</a>
			<button href="/" class="cart-buttons" id="submitBtn">
				PURCHASE
			</button>
		</div>
	</div>
	<div class="left">
		<h1>{{design}}</h1>
		<h3 class="designer">
			Designer:
			<a
				class="designer-name"
				style="color: #3b5998; text-decoration: underline"
				href=""
				>{{design.account}}</a
			>
		</h3>
		<h3>
			Price:â‚¹&nbsp{{ design.category.price|stringformat:"i"|slice:":-2" }}
		</h3>
	</div>

	<script>
		function getCookie(name) {
			const value = `; ${document.cookie}`;
			const parts = value.split(`; ${name}=`);
			if (parts.length === 2) return parts.pop().split(';').shift();
		}

		console.log("{{  }}")

		fetch('/api/config/')
			.then((result) => {
				return result.json();
			})
			.then((data) => {
				// Initialize Stripe.js
				const stripe = Stripe(data.publicKey);

				// new
				// Event handler
				document
					.querySelector('#submitBtn')
					.addEventListener('click', () => {
						fetch('http://127.0.0.1:8000/api/place-order/', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								'X-CSRFToken': getCookie('csrftoken'),
							},
							body: JSON.stringify({
								product: 5,
								address: 1,
								success_url: 'http://localhost:8000/',
								cancelled_url: 'http://localhost:8000/',
								quantity: 3,
							}),
						})
							.then((result) => {
								return result.json();
							})
							.then((data) => {
								console.log(data);
								return stripe.redirectToCheckout({
									sessionId: data.session_id,
								});
							})
							.then((res) => {
								console.log('No res');
								console.log(res);
							});
					});
			});
	</script>
</div>
{% endblock content %}
